---
title: å‰‘æŒ‡ Offer 51. æ•°ç»„ä¸­çš„é€†åºå¯¹
index_img: https://gitee.com/ylea/imagehost/raw/master/index_img/offer.jpg
banner_img: 'https://gitee.com/ylea/imagehost/raw/master/banner_img/44.png'
date: 2020-12-19 15:39:31
categories:
    - ç®—æ³•é¢˜
    - è§£ç­”
    - å‰‘æŒ‡Offer
tags:
    - åˆ†æ²»
    - äºŒå‰æœç´¢æ ‘
---

https://leetcode-cn.com/problems/shu-zu-zhong-de-ni-xu-dui-lcof/



åœ¨æ•°ç»„ä¸­çš„ä¸¤ä¸ªæ•°å­—ï¼Œå¦‚æœå‰é¢ä¸€ä¸ªæ•°å­—å¤§äºåé¢çš„æ•°å­—ï¼Œåˆ™è¿™ä¸¤ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªé€†åºå¯¹ã€‚è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ±‚å‡ºè¿™ä¸ªæ•°ç»„ä¸­çš„é€†åºå¯¹çš„æ€»æ•°ã€‚

**ç¤ºä¾‹ 1:**

è¾“å…¥: `[7,5,6,4]`

è¾“å‡º: `5`

**é™åˆ¶ï¼š**

`0 <= æ•°ç»„é•¿åº¦ <= 50000`



----



&emsp;&emsp;åœ¨æ•°ç»„ä¸­çš„ä¸¤ä¸ªæ•°å­—ï¼Œå¦‚æœå‰é¢ä¸€ä¸ªæ•°å­—å¤§äºåé¢çš„æ•°å­—ï¼Œåˆ™è¿™ä¸¤ä¸ªæ•°å­—ç»„æˆä¸€ä¸ªé€†åºå¯¹ã€‚è¾“å…¥ä¸€ä¸ªæ•°ç»„ï¼Œæ±‚å‡ºè¿™ä¸ªæ•°ç»„ä¸­çš„é€†åºå¯¹çš„æ€»æ•°ã€‚


# è§£æ³•1ï¼šäºŒå‰æœç´¢æ ‘

&emsp;&emsp;åœ¨ä¸€ç»„æ•°å­—ä¸­ï¼Œå¦‚ `[7, 5, 6, 4]`ï¼Œå¯¹äºæ¯ä¸ªæ•°å­—ï¼Œèƒ½å¦ç»„æˆé€†åºå¯¹å°±å¾—çœ‹å‰é¢æ˜¯å¦æœ‰å‡ºç°è¿‡æ¯”å½“å‰æ•°å­—å¤§çš„æ•°å­—ï¼Œè€Œè¿™ä¸ªæ•°å­—çš„ä¸ªæ•°å°±æ˜¯ä¸å½“å‰æ•°å­—æ„æˆçš„é€†åºå¯¹çš„ä¸ªæ•°ã€‚å¦‚ `4`ï¼Œé‚£ä¹ˆå‰é¢æœ‰ `3` ä¸ªæ¯” `4` å¤§çš„æ•°ï¼Œå› æ­¤ä¸å½“å‰æ•°å­— `4` ç»„æˆçš„é€†åºå¯¹ä¸ªæ•°å°±æ˜¯ `3`ã€‚

&emsp;&emsp;é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ä¸€ç§åŠæ³•æ¥å¿«é€Ÿæ‰¾åˆ°æ¯”å½“å‰æ•°å­—å¤§çš„å‡ºç°è¿‡çš„æ•°å­—çš„ä¸ªæ•°ï¼Œæƒ³åˆ°æ•ˆç‡é—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯èƒ½ä¼šè”æƒ³åˆ°**äºŒå‰æœç´¢æ ‘**ï¼š**å·¦å­æ ‘çš„èŠ‚ç‚¹å€¼éƒ½æ¯”çˆ¶èŠ‚ç‚¹å€¼å°ï¼Œå³å­æ ‘çš„èŠ‚ç‚¹å€¼éƒ½æ¯”å½“çˆ¶èŠ‚ç‚¹å€¼å¤§**ã€‚

&emsp;&emsp;æˆ‘ä»¬ä¸€è¾¹é¡ºåºéå†æ•°å­—ä¸€è¾¹å»ºæ ‘ï¼Œå¯¹äºéå†åˆ°çš„æ•°å­— `x`ï¼Œåœ¨å»ºæ ‘çš„è¿‡ç¨‹ä¸­ï¼Œè‹¥å½“å‰æ¯”è¾ƒçš„èŠ‚ç‚¹å€¼ `y` æ¯” `x` å¤§ï¼Œé‚£ä¹ˆå…¶å³å­æ ‘ä¸Šçš„èŠ‚ç‚¹å€¼ä¸€å®šéƒ½å¤§äº `x`ï¼Œå› æ­¤è¿™ä¸ªèŠ‚ç‚¹å€¼ `y` å’Œå…¶å³å­æ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹å€¼éƒ½èƒ½ä¸ `x` ç»„æˆä¸€ä¸ªé€†åºå¯¹ï¼Œæ‰€ä»¥é€†åºå¯¹çš„æ•°é‡å°±æ˜¯ï¼š**å³å­æ ‘èŠ‚ç‚¹çš„ä¸ªæ•° + 1ï¼ˆèŠ‚ç‚¹ yï¼‰**ï¼Œä¸è¿‡è€ƒè™‘åˆ°è¾“å…¥çš„æ•°ç»„ä¸­ä¼šå‡ºç°**é‡å¤çš„æ•°å­—**ï¼Œå› æ­¤æ¯ä¸ªèŠ‚ç‚¹ä¸­è¿˜éœ€è¦ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥ä¿å­˜å½“å‰èŠ‚ç‚¹å€¼çš„å‡ºç°æ¬¡æ•° `n`ï¼Œæ‰€ä»¥æœ€ç»ˆé€†åºå¯¹çš„ä¸ªæ•°å°±æ˜¯ï¼š**å³å­æ ‘èŠ‚ç‚¹çš„ä¸ªæ•° + å½“å‰èŠ‚ç‚¹çš„å‡ºç°æ¬¡æ•°**ã€‚

&emsp;&emsp;ç»¼ä¸Šï¼ŒäºŒå‰æœç´¢æ ‘çš„æ„é€ ä¸ºï¼š

```js
function Tree(val) {
	this.val = val;
    this.left = null;
    this.right = null;
    this.rightChildren = 0; // å³å­æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°
    this.n = 1;	// å½“å‰èŠ‚ç‚¹å€¼çš„å‡ºç°æ¬¡æ•°
}
```

å› æ­¤ç®—æ³•æ­¥éª¤å°±æ˜¯ï¼š

1. éå†è¾“å…¥æ•°ç»„ï¼Œå½“å‰éå†åˆ°çš„å€¼ä¸º `x`ï¼Œå°† `x` æ’å…¥äºŒå‰æœç´¢æ ‘ä¸­ï¼ŒäºŒå‰æœç´¢æ ‘çš„æ ¹ä¸º `nums[0]`ã€‚
2. æ’å…¥è¿‡ç¨‹ä¸­ä¼šå°† `x` å¯¹æ ‘ä¸­çš„èŠ‚ç‚¹å€¼è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥å½“å‰èŠ‚ç‚¹çš„å€¼å¤§äº `x` ï¼Œé‚£ä¹ˆå°† `x` æ’å…¥å…¶å·¦å­æ ‘ä¸­ï¼Œå¹¶ç´¯è®¡é€†åºå¯¹ä¸ªæ•°ï¼š`ans += node.rightChildren + node.n`ã€‚
3. è‹¥å½“å‰èŠ‚ç‚¹å€¼å°äº `x`ï¼Œé‚£ä¹ˆå°† `x` æ’å…¥å…¶å³å­æ ‘ä¸­ï¼Œä¸”å¢åŠ å³å­æ ‘èŠ‚ç‚¹ä¸ªæ•°ï¼š`node.rightChildren++`
4. è‹¥å½“å‰èŠ‚ç‚¹å€¼ç­‰äº `x`ï¼Œé‚£ä¹ˆå°† `x` çš„å‡ºç°æ¬¡æ•°åŠ 1ï¼š`node.n++`ï¼›ä¸”å½“å‰èŠ‚ç‚¹çš„å³å­æ ‘éƒ½èƒ½ä¸ `x` ç»„æˆé€†åºå¯¹ï¼Œå› æ­¤ `ans += node.rightChildren`ã€‚



ç”¨å›¾æ¥è¡¨ç¤ºå°±æ˜¯ï¼ˆä¸‹å›¾ä¸­çº¢è‰²ç‚¹ä»£è¡¨å½“å‰æ’å…¥çš„èŠ‚ç‚¹ï¼‰ï¼š

<img src="https://gitee.com/ylea/imagehost/raw/master/img/image-20201219162125669.png" alt="image-20201219162125669" style="zoom:80%;" />


**æƒ³æ³•å¾ˆå¥½ä½†é‡åˆ°äº†è¶…æ—¶çš„ case** ğŸ˜­

&emsp;&emsp;å› ä¸ºæœ‰ `case` æ˜¯å•è°ƒé€’å¢ã€é€’å‡çš„ï¼Œå› æ­¤äºŒå‰æ ‘é€€åŒ–æˆé“¾è¡¨ï¼Œç„¶åæ’å…¥æ“ä½œæ—¶é—´å¤æ‚åº¦å°±å˜æˆäº† `O(n^2)`ã€‚

**JS ä»£ç ï¼š**

```js
function Tree(val, left, right) {
    this.val = val;
    this.rightChildren = 0;
    this.n = 1;
    this.left = left || null;
    this.right = right || null;
}

var reversePairs = function(nums) {
    if (nums.length === 0) {
        return 0;
    }
    let root = new Tree(nums[0]);
    let ans = 0;

    const insert = (root, val) => {
        if (val === root.val) {
            ans += root.rightChildren;
            root.n++;
        } else if (val < root.val) {
            ans += root.rightChildren + root.n;
            if (!root.left) {
                root.left = new Tree(val);
            } else {
                insert(root.left, val);
            }
        } else {
            root.rightChildren++;
            if (!root.right) {
                root.right = new Tree(val);
            } else {
                insert(root.right, val);
            }
        }
    };

    for (let i = 1; i < nums.length; i++) {
        insert(root, nums[i]);
    }

    return ans;
};
```

# è§£æ³•äºŒï¼šå½’å¹¶

&emsp;&emsp;å½’å¹¶çš„æ€æƒ³æ˜¯å°†ä¸€ä¸ªåºåˆ—åˆ†ä¸ºä¸¤ä»½ï¼Œå¦‚ `L = [8, 12, 16, 22, 100]`ï¼Œ `R = [9, 26, 55, 64, 91]`ï¼›

&emsp;&emsp;é‚£ä¹ˆ**å·¦è¾¹çš„éƒ¨åˆ† `L` ä¸­çš„å€¼çš„ç´¢å¼•ä¸€å®šæ˜¯å°äºå³è¾¹éƒ¨åˆ† `R` ä¸­çš„å€¼çš„ç´¢å¼•çš„ã€‚** å› æ­¤**è‹¥ `L` ä¸­æœ‰å€¼æ¯” `R` ä¸­çš„å€¼å¤§**ï¼Œé‚£ä¹ˆä¸€å®šæ˜¯èƒ½ç»„æˆé€†åºå¯¹çš„ã€‚

&emsp;&emsp;ä¸”åŸºäºå½’å¹¶æ’åºï¼Œè¿™ä¸¤ä¸ªåºåˆ—éƒ½æ˜¯æœ‰åºçš„ï¼Œå› æ­¤å°±å¯ä»¥ä½¿ç”¨åŒæŒ‡é’ˆæ¥è¾…åŠ©è®¡ç®—é€†åºå¯¹ä¸ªæ•° `ans`ï¼Œæˆ‘ä»¬æŒ‰é¡ºåºæ¯”è¾ƒ `L` å’Œ `R` ä¸­çš„å€¼ï¼Œå‡è®¾ `L` çš„ç´¢å¼•æ˜¯ä» `l` åˆ° `mid` ï¼Œ`R` çš„ç´¢å¼•æ˜¯ä» `mid+1` åˆ° `r`ï¼Œé‚£ä¹ˆï¼š

- åˆå§‹æ—¶è®¾ç½®ä¸¤ä¸ªæŒ‡é’ˆï¼ŒæŒ‡é’ˆ `i` æŒ‡å‘ `L` ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´  `8`ï¼Œ`j` æŒ‡å‘ `R` ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´  `9`
- è‹¥ `nums[i] > nums[j]`ï¼Œé‚£ä¹ˆ `nums[i]` èƒ½ä¸ `nums[mid+1] ~ nums[j]` çš„æ‰€æœ‰æ•°å­—æ„æˆé€†åºå¯¹ï¼ˆå› ä¸ºåºåˆ— `R` æ˜¯é€’å¢çš„ï¼Œå› æ­¤ `nums[j]` ä¹‹å‰çš„æ•°ä¸€å®šä¼šå°äº `nums[j]`ï¼Œä¹Ÿå°±æ˜¯ä¼šå°äº `nums[i]`ï¼‰ï¼Œä½†æ­¤æ—¶æˆ‘ä»¬å…ˆä¸è®¡ç®—é€†åºå¯¹ä¸ªæ•°ï¼ˆåé¢å†ä¸€èµ·è®¡ç®—ï¼‰ï¼Œå°† `j` å‘åç§»ä¸€ä½ï¼š`j++`
- è‹¥ `nums[i] <= nums[j]`ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ•°æ— æ³•æ„æˆé€†åºå¯¹ï¼Œæ­¤æ—¶è®¡ç®— `nums[i]` èƒ½ä¸ `R` ä¸­å…ƒç´ ç»„æˆçš„é€†åºå¯¹ä¸ªæ•°ï¼š`ans += j - mid - 1`ï¼ˆ`mid + 1 ~ j - 1` çš„å…ƒç´ ä¸ªæ•°ï¼‰ï¼ŒæŒ‡é’ˆ `i` å‘åç§»ä¸€ä½ï¼š`i++`
- å½“ `i > mid` æˆ– `j > r` æ—¶ï¼Œé€€å‡ºå¾ªç¯ï¼Œæ­¤æ—¶ï¼š
  -  è‹¥ `i <= mid`ï¼Œé‚£ä¹ˆè¯´æ˜ `i` åŠ `i` ä¹‹åçš„æ•°éƒ½ä¼š**å¤§äº** `nums[mid + 1] ~ nums[r]`ï¼ˆå› ä¸ºå¾ªç¯ä¸­æ˜¯å½“ `nums[i] > nums[j]` æ—¶ `j` æ‰å‘åç§»ä¸€ä½ï¼‰ï¼Œå› æ­¤è¿™äº›æ•°å­—éƒ½èƒ½ä¸ `R` ä¸­çš„æ‰€æœ‰æ•°å­—ç»„æˆé€†åºå¯¹ï¼Œæ‰€ä»¥èƒ½å¤Ÿç»„æˆçš„é€†åºå¯¹çš„ä¸ªæ•°æ˜¯ `L ä¸­å‰©ä½™çš„å…ƒç´ ä¸ªæ•° * R ä¸­çš„å…ƒç´ ä¸ªæ•°`ï¼Œä¹Ÿå°±æ˜¯ï¼š`ans += (mid - i + 1) * (r - mid)`

JS ä»£ç ä¸ºï¼š

```js
var reversePairs = function(nums) {
    let ans = 0;

    // åˆå¹¶æ“ä½œï¼Œå°† [l, mid] å’Œ [mid+1, r] ä½ç½®çš„å…ƒç´ ä»å°åˆ°å¤§åˆå¹¶
    const merge = (l, mid, r) => {
        let res = [];
        let i = l, j = mid + 1;
        while (i <= mid && j <= r) {
            if (nums[i] <= nums[j]) {
                res.push(nums[i]);
                i++;
            } else {
                res.push(nums[j]);
                j++;
            }
        }

        while(i <= mid) {
            res.push(nums[i++]);
        }
        while (j <= r) {
            res.push(nums[j++]);
        }

        i = l;
        for (let n of res) {
            nums[i++] = n;
        }
    };

    const mergeSort = (l, r) => {
        if (l < r) {
            let mid = l + Math.floor((r - l) / 2);
            mergeSort(l, mid);
            mergeSort(mid + 1, r);

            let i = l, j = mid + 1;

            while (i <= mid && j <= r) {
                // å½“ nums[i] <= nums[j] æ—¶ï¼Œè®¡ç®— nums[i] èƒ½ä¸ nums[mid + 1 ~ j - 1] ç»„æˆé€†åºå¯¹
                if (nums[i] <= nums[j]) {
                    i++;
                    ans += j - mid - 1;
                } else {
                    j++;
                }
            }
            // è‹¥å‡ºå¾ªç¯å R å·²ç»éå†å®Œäº†ï¼Œé‚£ä¹ˆ L ä¸­çš„å‰©ä½™æ•°å­—éƒ½èƒ½ä¸ R ä¸­çš„æ•°å­—ç»„æˆé€†åºå¯¹
            if (i <= mid) {
                ans += (mid + 1 - i) * (r - mid);
            }

            merge(l, mid, r);
        }
    };

    mergeSort(0, nums.length-1);

    return ans;
};
```

