---
title: 1. HTTP概述
index_img: https://gitee.com/ylea/imagehost/raw/master/img/http.jpg
banner_img: https://gitee.com/ylea/imagehost/raw/master/banner_img/2.jpg
date: 2020-09-21 20:41:56
hide: true
categories:
    - 计算机基础
    - HTTP
tags:
    - HTTP
---

# 1. WEB资源

## 1.1 媒体类型

&emsp;&emsp;MIME（Multipurpose Internet Mail Extention，多用途因特网邮件拓展）。

&emsp;&emsp;MIME类型 （MIME type）是一种文本标记，表示一种主要的对象类型和一个特定的子类型，中间由一条斜杠来分隔。

&emsp;&emsp;WEB 服务器会为所有的 HTTP 对象数据附加一个 MIME 类型，当 WEB 浏览器从服务器中取回一个对象时，会检查相关的 MIME 类型，看看它是否知道如何处理这个对象。

常见的 MIME 类型有数百个，部分如下所示：

- HTML 格式的文本文档由 `text/html` 类型来标记
- 普通的 ASCII 文本文档由 `text/plain` 类型来标记
- JPEG 格式的图片为 `image/jpeg` 类型
- GIF 格式的图片为 `image/jif` 类型
- Apple 的 QuickTime 电影为 `video/quicktime` 类型
- ......

## 1.2 URI

&emsp;&emsp;每个 WEB 服务器资源都有一个名字，这些名字被统称为 **统一资源标识符**（Uniform Resource Identifier, URI）。

&emsp;&emsp;URI 有两种形式，分别称为 URL 和 URN，不过 URN 见的较少，现在几乎所有的 URI 都是 URL，这边没有记录 URN。

### URL

&emsp;&emsp;**统一资源定位符**（URL）描述了一台特定服务器上某资源的特定位置。

**URL 说明了协议、服务器和本地资源** ：

​	<img src="https://gitee.com/ylea/imagehost/raw/master/img/image-20200920183803074.png" alt="image-20200920183803074" style="zoom:80%;" />

大部分 URL 都遵循着一种标准格式，这个格式包含三个部分：

- URL 的第一部分被称为方案（scheme），说明了访问资源所使用的协议类型。如 `http://` 。
- 第二部分个给出了服务器的因特网地址，如 `www.joes-hardware.com`。
- 其余部分指定了 WEB 服务器上的某个资源，如 `/specials/saw-blade.gif`。

## 1.3 事务

&emsp;&emsp;一个 HTTP 事务是由一条（客户端发往服务器）请求命令和一个（服务器发回客户端）响应结果组成。

&emsp;&emsp;这种通信是通过名为 HTTP 报文（HTTP message）的格式化数据块进行的。如下图所示：

<img src="https://gitee.com/ylea/imagehost/raw/master/img/image-20200921090503302.png" alt="image-20200921090503302" style="zoom: 67%;" />

## 1.4 方法

&emsp;&emsp;每条 HTTP 请求报文都包含一个方法（HTTP method），这个方法会告诉服务器需要执行什么动作（获取一个 Web 页面、运行一个网关程序、删除一个程序等）。下表列出了五种常见的 HTTP 方法：

<img src="https://gitee.com/ylea/imagehost/raw/master/img/image-20200921090837035.png" alt="image-20200921090837035" style="zoom:75%;" />

## 1.5 状态码

&emsp;&emsp;每条 HTTP 响应报文返回时都会携带一个状态码。状态码是一个三位数字的代码，它会告知客户端这条请求的状态，下表显示了几种常见的状态码：

<img src="https://gitee.com/ylea/imagehost/raw/master/img/image-20200921091213730.png" alt="image-20200921091213730" style="zoom:80%;" />

# 2. 报文

&emsp;&emsp;HTTP 报文是由一行一行的简单字符串组成的。HTTP 报文是纯文本，不是二进制代码。

&emsp;&emsp;下图是一个简单事务所使用的报文：

<img src="https://gitee.com/ylea/imagehost/raw/master/img/image-20200921093721791.png" alt="image-20200921093721791" style="zoom: 80%;" />

&emsp;&emsp;HTTP 报文只包含两种类型：**请求报文** (request message) 和**响应报文** (response message) 。

HTTP 报文包括以下三个部分：

- 起始行：报文的第一行是起始行，在**请求报文**中用于说明要做些说明，在**响应报文**中说明出现了什么情况。
- 首部字段：起始行后有零或多个首部字段。一个首部字段包含一个字段名和值，两者使用 `:` 分隔。首部字段以一个空行结束。
- 主体：首部字段的空行之后就是可选的报文主体。**请求主体**中包含了要发送给 Web 服务器的数据；**响应主体**中装载了要返回给客户端的数据。与起始行和首部不同，主体中可以包含文本或任意的二进制数据（如图片、视频、音频、软件程序等）。

# 3. 连接

&emsp;&emsp;报文是通过**传输控制协议**（Transmission Control Protocol，**TCP**）连接从一个地方传递到另一个地方。

## 3.1 TCP/IP

&emsp;&emsp;HTTP 是个应用层协议，其内部的通信细节都由 TCP/IP 来完成。

TCP 提供了：

- 无差错的数据传输
- 按序传输（数据总是会按照发送的顺序到达）
- 未分段的数据流（可以在任意时刻以任意尺寸将数据发送出去）

&emsp;&emsp;HTTP 位于 TCP 的上层，下图是 HTTP 网络协议栈：

<img src="https://gitee.com/ylea/imagehost/raw/master/img/image-20200921095353410.png" alt="image-20200921095353410" style="zoom: 80%;" />

## 3.2 连接、IP 地址及端口号

&emsp;&emsp;在 HTTP 客户端向服务器发送报文之前，需要使用网际协议（Internet Protocol，IP）地址和端口号在客户端和服务器之间建立一条 TCP/IP 连接。

&emsp;&emsp;建立 TCP 连接的过程类似于给公司办公室的某个人打电话的过程；首先，需要拨打正确的公司的电话号码，然后再拨打那个人的公司分机号。

&emsp;&emsp;HTTP 服务器的 IP 和端口号是通过 URL 获取的。

如 

- `http://207.200.83.29:80/index.html`
- `http://www.netscape.com:80/index.html`
- `http://www.metscape.com/index.html`

&emsp;&emsp;第三条 URL 中没有指定端口号则会使用默认的端口号，如 `80`

&emsp;&emsp;下图是一个基本的浏览器连接处理过程：

<img src="https://gitee.com/ylea/imagehost/raw/master/img/image-20200921100649034.png" alt="image-20200921100649034" style="zoom: 80%;" />

步骤如下：

1. 浏览器从 URL 中解析出服务器的主机名；
2. 浏览器将服务器的主机名转换成服务器的 IP 地址；
3. 浏览器将端口号（若有指定）从 URL 中解析出来；
4. 浏览器建立一条与 WEB 服务器的 TCP 连接；
5. 浏览器向服务器发送一条 HTTP 请求报文；
6. 服务器向浏览器会送一条 HTTP 响应报文；
7. 关闭连接，浏览器显示文档。

# 4. 协议版本

HTTP 有多个协议版本：

- HTTP/0.9
- HTTP/1.0
- HTTP/1.0+
- HTTP/1.1
- HTTP-NG (又名 HTTP/2.0)

&emsp;&emsp;不过目前在广泛使用的仍是 HTTP/1.1 版本

# 5. Web 的结构组件

## 5.1 代理

&emsp;&emsp;代理是位于客户端和服务器之间的 HTTP 中间实体，它是 Web 安全、应用集成以及性能优化的重要组成模块。

<img src="https://gitee.com/ylea/imagehost/raw/master/img/image-2020092110112604125.png" alt="image-2020092110260412511" style="zoom:80%;" />

&emsp;&emsp;代理接收所有客户端的 HTTP 请求，并将这些请求转发给服务器（可能会对请求进行修改）。代理还能对请求和响应进行过滤，比如对下载的应用程序进行病毒检测、或对小学生屏蔽一些成年人才能看的内容。

## 5.2 缓存

&emsp;&emsp;缓存是 HTTP 的仓库，常用的页面副本可以保存在离客户端更近的地方。

&emsp;&emsp;Web 缓存（Web cache）或代理缓存（proxy cache）是一种特殊的 HTTP 代理服务器，可将经过代理的常用文档的副本保存下来，下次再访问这个资源时就能直接在代理服务器上下载，加快了下载速度。

## 5.3 网关

&emsp;&emsp;网关（gateway）是一种特殊的服务器，作为其他服务器的中间实体使用。

&emsp;&emsp;通常用于将 HTTP 流量转换成其他的协议。

&emsp;&emsp;例如，一个 HTTP/FTP 网关会通过 HTTP 请求接收对 FTP URI 的请求，但通过 FTP 协议来获取文档。得到的文档会封装成一条 HTTP 报文，发送给客户端。

<img src="https://gitee.com/ylea/imagehost/raw/master/img/image-20200921104641330.png" alt="image-20200921104641330" style="zoom:80%;" />

## 5.4 隧道

&emsp;&emsp;隧道（tunnel）是建立起来之后，就会在两条连接之间对原始数据进行盲转发的 HTTP 应用程序。

&emsp;&emsp;HTTP 隧道通常用来在一条或多条 HTTP 连接上转发非 HTTP 数据，转发时不会窥探数据。

&emsp;&emsp;HTTP 隧道的一种常见的用途就是通过 HTTP 连接承载加密的安全套接字层（SSL，Secure Sockets Layer）流量，这样 SSL 流量就可以穿过只允许 Web 流量通过的防火墙了。

&emsp;&emsp;如下图所示，HTTP/SSL 隧道收到一条 HTTP 请求，要求建立一条到目的地址和端口的输出连接，然后在 HTTP 信道上通过隧道 传输 加密的 SSL 流量，这样就能将其盲转发到目的服务器上去了。

<img src="https://gitee.com/ylea/imagehost/raw/master/img/image-20200921105518446.png" alt="image-20200921105518446" style="zoom:80%;" />

## 5.5 Agent 代理

&emsp;&emsp;用户 Agent 代理是代表用户发起 HTTP 请求的客户端程序。

&emsp;&emsp;我们常用的一种 Agent 代理就是 Web 浏览器。




